<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Hiển thị dữ liệu API</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/1.4.0/css/searchPanes.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/searchpanes/1.4.0/js/dataTables.searchPanes.min.js"></script>


  <style>
    /* Custom styling for the Bootstrap switch */
  .form-switch {
    display: flex;
    align-items: center;
  }

  .form-switch .form-check-input {
    margin-left: 5px; /* Adjust margin for spacing */
  }

  .form-switch .form-check-label {
    margin-left: 10px; /* Adjust margin for spacing */
  }

  .form-check-input:checked {
    background-color: #2196F3; /* Color when checked */
  }

  .form-check-input:focus {
    box-shadow: 0 0 1px #2196F3; /* Focus style */
  }

  .form-check-label {
    color: #000; /* Label color */
  }
  .btn {
background-color: #FF593E;
    color: aliceblue;
  }
  </style>
</head>

<body>
  <div class="container">
    <a href="/api/admin/products/create" class="btn btn-primary fa-lg gradient-custom-2 mb-3">Tạo sản phẩm mới</a>
    <h3>Bảng sản phẩm </h3>
    <table id="datatable" class="table table-striped" style="width:100%">
      <thead>
        <tr>
  
          <th style="color: #000000">Ảnh sản phẩm</th>
          <th style="color: #000000">Tên sản phẩm</th>
          <th style="color: #000000">Giá sản phẩm</th>
          <th style="color: #000000">Danh mục</th>
          <th style="color: #000000">Chi tiết</th>
          <th style="color: #000000">Trạng thái bán</th>
        </tr>
      </thead>
      <tbody>
        {{#each data}}
        <tr>
          
          <td><img src="{{this.images.0.url}}" alt="Product Image" width="100px" height="60px" id="img-preview"></td>
          <td>{{this.product_name}}</td>
          <td>{{this.product_price}}</td>
          <td class="category-cell" data-category-id="{{this.categoryId}}">Loading...</td>
          <td><a href="/api/admin/products/{{this._id}}" class="btn btn-primary fa-lg gradient-custom-2 mb-3">Chi tiết</a></td>
          <td>
            <label class="switch">
              <input type="checkbox" class="btn-toggle-active" data-product-id="{{this._id}}" {{#if this.isActive}}checked{{/if}}>
              <span class="slider"></span>
            </label>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  <script>
    // Xử lý sự kiện change cho checkbox toggle-active
    $(document).on('change', '.btn-toggle-active', function () {
      // Lưu giữ tham chiếu đến phần tử hiện tại
      const checkbox = $(this);

      const productId = checkbox.data('product-id');
      const isActive = checkbox.is(':checked'); // Sử dụng is(':checked') để kiểm tra checkbox
      console.log('Product ID:', productId);

      // Gửi yêu cầu PATCH tới API để cập nhật trạng thái isActive của sản phẩm
      $.ajax({
        type: 'PATCH',
        url: `http://localhost:3000/api/toggleActive/${productId}`,
        success: function (data) {
          // Cập nhật trạng thái của checkbox
          checkbox.prop('checked', isActive); // Sử dụng giá trị thực tế của isActive
        },
        error: function (error) {
          console.error('Lỗi khi chuyển đổi trạng thái kích hoạt:', error);
        }
      });

      // Rest of your code...
    });

    $.get('http://localhost:3000/api/categories', function (categories) {
      const categoryMap = {};

      categories.forEach(function (category) {
        categoryMap[category._id] = category.category_name;
      });

      $('.category-cell').each(function () {
        const categoryId = $(this).data('category-id');
        const categoryName = categoryMap[categoryId];
        console.log(categoryName)
        $(this).text(categoryName);
      });
    });

    $(document).ready(function () {
      $('#datatable').DataTable({});
    });

    function rowStyle(row, index) {
      return {
        classes: 'text-nowrap another-class',
        css: {
          "color": "blue",
          "font-size": "50px"
        }
      };
    }
  </script>
</body>

</html>
