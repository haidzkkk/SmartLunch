<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Thùng rác</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/1.4.0/css/searchPanes.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/searchpanes/1.4.0/js/dataTables.searchPanes.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <style>
    table.table-striped {
      text-align: center;
    }

    .btn {
      background-color: #FF593E;
      color: aliceblue;
    }

    h3 {
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="container">
    <h3>Thùng rác</h3>
    <table id="datatable" class="table table-striped " style="width:100%">
      <thead>
        <tr>
          <th style="color: #FF593E;text-align: center">Tên sản phẩm</th>
          <th style="color: #FF593E;text-align: center">Giá</th>
          <th style="color: #FF593E;text-align: center">Mô tả</th>
          <th style="color: #FF593E;text-align: center">Danh mục</th>
          <th style="color: #FF593E;text-align: center">Xóa</th>
          <th style="color: #FF593E;text-align: center">Khôi phục</th>
        </tr>
      </thead>
      <tbody>
        {{#each data}}
        <tr>
          <td>{{this.product_name}}</td>
          <td>{{this.product_price}}</td>
          <td>{{this.description}}</td>
          <td>{{this.categoryId}}</td>
          <td><a href="/api/deletebyadmin/products/{{this._id}} "
              data-confirm="Bạn có chắc chắn muốn xóa sản phẩm này không?" id="deleteForm"
              style="text-decoration: none"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                fill="#FF593E" class="bi bi-x-octagon-fill" viewBox="0 0 16 16">
                <path
                  d="M11.46.146A.5.5 0 0 0 11.107 0H4.893a.5.5 0 0 0-.353.146L.146 4.54A.5.5 0 0 0 0 4.893v6.214a.5.5 0 0 0 .146.353l4.394 4.394a.5.5 0 0 0 .353.146h6.214a.5.5 0 0 0 .353-.146l4.394-4.394a.5.5 0 0 0 .146-.353V4.893a.5.5 0 0 0-.146-.353L11.46.146zm-6.106 4.5L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708z" />
              </svg></a></td>
          <script>
            const deleteForm = document.getElementById('deleteForm');

            deleteForm.addEventListener('click', function (event) {
              const confirmDelete = confirm("Bạn có chắc chắn muốn xóa sản phẩm này không?");
              if (!confirmDelete) {
                event.preventDefault();
              }
            });
          </script>
          <td><a href="/api/products/restore/{{this._id}}" type="submit" id="productForm" style="text-decoration: none"><svg
                xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#FF593E" class="bi bi-recycle"
                viewBox="0 0 16 16">
                <path
                  d="M9.302 1.256a1.5 1.5 0 0 0-2.604 0l-1.704 2.98a.5.5 0 0 0 .869.497l1.703-2.981a.5.5 0 0 1 .868 0l2.54 4.444-1.256-.337a.5.5 0 1 0-.26.966l2.415.647a.5.5 0 0 0 .613-.353l.647-2.415a.5.5 0 1 0-.966-.259l-.333 1.242-2.532-4.431zM2.973 7.773l-1.255.337a.5.5 0 1 1-.26-.966l2.416-.647a.5.5 0 0 1 .612.353l.647 2.415a.5.5 0 0 1-.966.259l-.333-1.242-2.545 4.454a.5.5 0 0 0 .434.748H5a.5.5 0 0 1 0 1H1.723A1.5 1.5 0 0 1 .421 12.24l2.552-4.467zm10.89 1.463a.5.5 0 1 0-.868.496l1.716 3.004a.5.5 0 0 1-.434.748h-5.57l.647-.646a.5.5 0 1 0-.708-.707l-1.5 1.5a.498.498 0 0 0 0 .707l1.5 1.5a.5.5 0 1 0 .708-.707l-.647-.647h5.57a1.5 1.5 0 0 0 1.302-2.244l-1.716-3.004z" />
              </svg></a></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    <script>
      $(document).ready(function () {
        $('#datatable').DataTable({
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const productForm = document.getElementById("productForm");
        console.log(productForm);
        productForm.addEventListener("submit", async (event) => {
          event.preventDefault();
          const formData = new FormData(productForm);
          const token = localStorage.getItem("accessToken");

          console.log("aaa" + token);
          if (!token) {
            // Handle the case where the token is missing or invalid
            console.error("Token is missing or invalid");
            return;
          }

          try {
            const response = await fetch(productForm.action, {
              method: "POST",
              body: formData,
              headers: {
                "Authorization": "Bearer " + token,
              },
            });

            if (response.ok) {
              // Product created successfully, handle the response here
              const productData = await response.json();
              console.log("Product created:", productData);
            } else {
              // Handle errors, e.g., display an error message
              console.error("Product creation failed");
            }
          } catch (error) {
            // Handle network or other errors
            console.error("Error:", error);
          }
        });
      })
    </script>

</html>